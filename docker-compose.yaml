services:
  backend:
    build: ./mern/backend
    ports:
      - "5050:5050" 
    networks:
      - mern_network
    environment:
      MONGO_URI: mongodb://mongodb:27017
    depends_on:
      - mongodb
    # healthcheck:
    #   test: |
    #     curl -f http://localhost:5050/startup &&
    #     curl -f http://localhost:5050/ready &&
    #     curl -f http://localhost:5050/health
    #   interval: 30s
    #   timeout: 10s
    #   retries: 5
    #   start_period: 40s


  frontend:
    build: 
      context: ./mern/frontend
      args:
        VITE_API_URL: http://44.201.204.19:5050
    ports:
      - "80:80"  
    networks:
        - mern_network
    # healthcheck:
    #   test: ["CMD", "curl", "-f", "http://localhost:5173/"]
    #   interval: 30s
    #   timeout: 10s
    #   retries: 5
    #   start_period: 10s
    
    


  mongodb:
    image: mongo:latest  
    ports:
      - "27017:27017"  
    networks:
      - mern_network
    volumes:
      - mongo-data:/data/db  

networks:
  mern_network:
    driver: bridge 

volumes:
  mongo-data:
    driver: local  # Persist MongoDB data locally

